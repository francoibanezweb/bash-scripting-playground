#!/bin/bash

# Initialize counters
total_node_modules=0
total_package_lock_json=0
total_storage_freed=0

# function to delete node_modules and package-lock.json
function delete_node_modules() {
  if [ -d "node_modules" ]; then
    echo "Removing node_modules in $PWD"
    ((total_storage_freed+=$(du -sxb node_modules | awk '{print $1}')))
    rm -rf node_modules
    ((total_node_modules++))
  fi
  if [ -f "package-lock.json" ]; then
    echo "Removing package-lock.json in $PWD"
    ((total_storage_freed+=$(du -sxb package-lock.json | awk '{print $1}')))
    rm package-lock.json
    ((total_package_lock_json++))
  fi
}

# function to search recursively for node_modules and package-lock.json
function search_and_delete() {
  for file in *
  do
    if [ -d "$file" ]; then
      cd "$file"
      search_and_delete
      cd ..
    fi
  done
  delete_node_modules
}

# start searching and deleting from the current directory
search_and_delete 

# calculate storage freed in megabytes
total_storage_freed_mb=$(echo "scale=2; $total_storage_freed / 1000000" | bc)


# print final message in shiny green bold text
echo -e "\033[1;32mDeleted $total_node_modules node_modules directories and $total_package_lock_json package-lock.json files, freeing $total_storage_freed_mb Mbs of storage.\033[0m"

